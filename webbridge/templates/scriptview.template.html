{{define "title"}}{{.ScriptAccountHandle}}/{{.ScriptName}} | Scripts{{end}}

{{define "head"}}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/codemirror.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/codemirror.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/mode/lua/lua.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/mode/shell/shell.min.js"></script>
{{end}}

{{define "body"}}
<h1>Script: <samp>{{.ScriptAccountHandle}}/{{.ScriptName}}</samp></h1>
<form method="POST" action="/scripts/{{.ScriptAccountHandle}}/{{.ScriptName}}">
    <p>
        <label>Highlight as: <select id="modes"></select></label>
    </p>

    <p>
        <textarea name="content" id="editor">{{.ScriptContent}}</textarea>
    </p>

    <h2>Requirements</h2>
    <p>
        <label>
            <input type="checkbox" name="bill_usage_to_owner" {{if .Requirements.BillUsageToOwner}}checked{{end}}> <strong>Bill usage to owner?</strong><br>
            If checked, all usage costs that would usually be billed to the executor of the script will be billed to the owner (you!).
        </label>
    </p>

    <p>
        <button type="submit">Save</button>
    </p>
</form>

<form method="POST" action="/scripts/{{.ScriptAccountHandle}}/{{.ScriptName}}/delete">
    <button type="submit" onclick="return confirm('Are you sure you want to delete this script? This is IRREVERSIBLE!')">Delete</button>
</form>

<nav>
    <ul>
        <li><a href="/scripts/{{.ScriptAccountHandle}}">Return to account script index</a></li>
        <li><a href="/scripts">Return to script index</a></li>
        <li><a href="/">Return to account home page</a></li>
    </ul>
</nav>

<script>
(function() {
    var cm = CodeMirror.fromTextArea(document.getElementById("editor"), {
        mode: 'null',
        lineNumbers: true,
        viewportMargin: Infinity,
        indentUnit: 4,
        tabSize: 4,
        indentWithTabs: false,
        extraKeys: {
            Tab: function (cm) {
                if (cm.somethingSelected()) {
                    cm.indentSelection("add");
                } else {
                    cm.replaceSelection(cm.getOption("indentWithTabs") ? "\t" : Array(cm.getOption("indentUnit") + 1).join(" "), "end", "+input");
                }
            }
        }
    });

    var modesSelect = document.getElementById("modes");
    Object.keys(CodeMirror.modes).forEach(function (k) {
        var option = document.createElement('option');
        option.value = k;
        option.textContent = k;
        option.checked = k == cm.getOption('mode');
        modesSelect.appendChild(option);
    })
    modesSelect.onchange = function () {
        cm.setOption('mode', this.value);
    };
})();
</script>
{{end}}
